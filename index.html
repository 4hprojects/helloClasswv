<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Hello Class RFID Logger</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; transition: background-color 0.5s, color 0.5s; }
        #rfidInput { width: 300px; padding: 10px; font-size: 16px; }
        #addButton, #saveButton, #themeToggleButton {
            margin-top: 10px; padding: 10px 20px; font-size: 16px;
        }
        #log { margin-top: 20px; max-height: 300px; overflow-y: auto; }
        .log-entry { border-bottom: 1px solid #ccc; padding: 5px 0; }
        #progressIndicator { display: none; margin-top: 10px; font-size: 14px; color: green; }
        .dark-mode { background-color: #121212; color: #ffffff; }
    </style>
</head>
<body>
    <h1>Hello Class RFID Logger</h1>
    <input type="text" id="rfidInput" placeholder="Scan RFID here" autofocus />
    <button id="addButton">Add Entry</button>
    <div id="log"></div>
    <button id="saveButton">Save Log</button>
    <button id="themeToggleButton">Toggle Dark Mode</button>
    <div id="progressIndicator">Saving entries, please wait...</div>

    <script>
        // script.js

const rfidInput = document.getElementById('rfidInput');
const addButton = document.getElementById('addButton');
const saveButton = document.getElementById('saveButton');
const logDiv = document.getElementById('log');
const themeToggleButton = document.getElementById('themeToggleButton');
let rfidLog = JSON.parse(localStorage.getItem('rfidLog')) || [];

// Ensure the input field is always focused
function maintainFocus() {
    rfidInput.focus();
}

window.onload = () => {
    maintainFocus();
    loadLogEntries();
};
rfidInput.onblur = () => setTimeout(maintainFocus, 0);

// Function to format the timestamp
function formatTimestamp(date) {
    const day = String(date.getDate()).padStart(2, '0');
    const month = String(date.getMonth() + 1).padStart(2, '0'); // Months are zero-based
    const year = date.getFullYear();
    const hours = String(date.getHours()).padStart(2, '0');
    const minutes = String(date.getMinutes()).padStart(2, '0');
    const seconds = String(date.getSeconds()).padStart(2, '0');
    return `${day}/${month}/${year} ${hours}:${minutes}:${seconds}`;
}

// Function to add log entry to the display and store in memory
function addLogEntry(rfidCode, timestamp) {
    const entryText = `${timestamp} ${rfidCode}`;

    // Display the entry
    const entry = document.createElement('div');
    entry.className = 'log-entry';
    entry.textContent = entryText;
    logDiv.prepend(entry); // Add new entries to the top

    // Store the entry in the log array
    rfidLog.push(entryText);
    localStorage.setItem('rfidLog', JSON.stringify(rfidLog));
}

// Function to handle adding an entry (both from Enter key and Add Entry button)
function handleAddEntry() {
    const rfidCode = rfidInput.value.trim();
    if (rfidCode) {
        const timestamp = formatTimestamp(new Date());
        addLogEntry(rfidCode, timestamp);
        rfidInput.value = '';
    }
}

// Event listener for RFID input
rfidInput.addEventListener('keydown', function(event) {
    if (event.key === 'Enter') {
        handleAddEntry();
        event.preventDefault(); // Prevent default action
    }
});

// Event listener for Add Entry button
addButton.addEventListener('click', function() {
    handleAddEntry();
});

// Event listener for Save Button to save log entries to a file
saveButton.addEventListener('click', function() {
    if (rfidLog.length === 0) {
        alert('No entries to save.');
        return;
    }

    // Prepare data to save
    const data = rfidLog.join('\n');

    // Generate default file name
    const now = new Date();
    const defaultFileName = `RFID_Log_${formatTimestamp(now).replace(/[\/: ]/g, '_')}.txt`;

    // Create a blob with the data
    const blob = new Blob([data], { type: 'text/plain' });

    // Create a link to trigger the download
    const link = document.createElement('a');
    link.href = window.URL.createObjectURL(blob);
    link.download = defaultFileName;
    link.click();

    // Clean up
    window.URL.revokeObjectURL(link.href);
});

// Function to load log entries from localStorage and display them
function loadLogEntries() {
    rfidLog.forEach(entryText => {
        const entry = document.createElement('div');
        entry.className = 'log-entry';
        entry.textContent = entryText;
        logDiv.prepend(entry);
    });
}

// Function to toggle dark mode
themeToggleButton.addEventListener('click', function() {
    document.body.classList.toggle('dark-mode');
    const isDarkMode = document.body.classList.contains('dark-mode');
    localStorage.setItem('darkMode', isDarkMode ? 'enabled' : 'disabled');
});

// Load dark mode preference
if (localStorage.getItem('darkMode') === 'enabled') {
    document.body.classList.add('dark-mode');
}
    </script>
</body>
</html>
